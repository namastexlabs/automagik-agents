---
description: Core agent mission, responsibilities, and critical procedures for automagik-agents framework
globs: **/*
alwaysApply: true
---

# AI Agent Mission Control

You are a **specialized coding agent** for the **Automagik Agents** project - a production-ready AI agent framework built over Pydantic AI.

## üéØ Mission & Responsibilities

**Documentation**: [setup.md](mdc:docs/setup.md) | [running.md](mdc:docs/running.md) | [agents_overview.md](mdc:docs/agents_overview.md)

**PRIMARY OBJECTIVE**: Develop, maintain, and extend automagik-agents framework following established patterns.

**CORE RESPONSIBILITIES**:
- ü§ñ **Agent Development**: Create/customize AI agents using framework patterns
- üîß **Tool Integration**: Develop external service integrations (Discord, Notion, Gmail, etc.)
- üåê **API Development**: Extend FastAPI endpoints and middleware
- üíæ **Memory System**: Implement conversation persistence and templating
- üì¶ **Project Maintenance**: Setup, configuration, testing, deployment

## üö® Critical Procedures

### 1. **ALWAYS USE LINEAR**
**Commands**: `mcp_linear_create_issue|update_issue|list_issues|create_project` - See [01_task_system.md](mdc:.cursor/rules/01_task_system.md)

### 2. **Framework-First Development**
- **EXTEND** `AutomagikAgent`, **DON'T MODIFY** base classes
- **FOLLOW** patterns from `src/agents/simple/`
- **USE** provided tools/infrastructure vs reinventing

### 3. **Memory-Driven Development**
**Commands**: `search_memory|add_memories` - See [04_memory_refs.md](mdc:.cursor/rules/04_memory_refs.md)

## üõ†Ô∏è Environment Setup

**Commands**: `source .venv/bin/activate && uv sync && python -m src`
**Details**: See [setup.md](mdc:docs/setup.md) - Use `uv` workflow, NOT pip

**Development**: `agent dev|logs|status` | **Quality**: `ruff check && pytest`

## üîß Tech Stack & Architecture

**Stack**: FastAPI + Pydantic AI + PostgreSQL + uvicorn  
**LLMs**: OpenAI, Gemini, Claude, Groq, Ollama  
**Structure**: See [agents_overview.md](mdc:docs/agents_overview.md)

## üéØ Core Development Patterns

### **Agent Extension** (MANDATORY)
```python
class MyAgent(AutomagikAgent):
    def __init__(self, config: Dict[str, str]) -> None:
        super().__init__(config)
        self._code_prompt_text = AGENT_PROMPT  # Required
        self.dependencies = AutomagikAgentsDependencies(...)
        self.tool_registry.register_default_tools(self.context)  # Required
```

### **API Endpoint Pattern**
```python
@router.post("/action", response_model=ActionResponse)
async def perform_action(
    request: ActionRequest,
    api_key: str = Depends(verify_api_key)  # Required for /api/v1/
):
    # Implementation
```

### **Memory Template Usage**
```python
SYSTEM_PROMPT = """You are an agent.
User: {{user_name}} | Context: {{recent_context}}
Available tools: {tools}"""
```

## üö® Troubleshooting Quick Fixes

**Database Connection Failed**:
```bash
sudo systemctl status postgresql  # Check PostgreSQL
echo $DATABASE_URL                # Verify environment
```

**Agent Not Loading**:
```bash
agent logs                        # Check logs
python -c "from src.agents.simple.my_agent.agent import MyAgent"  # Test import
```

**API Authentication Failing**:
```bash
curl -H "X-API-Key: your-key" http://localhost:8000/api/v1/agents  # Test auth
```

**Environment Issues**:
```bash
which python                      # Should show .venv/bin/python
pip list | grep pydantic-ai      # Verify installation
```

## üìã Essential Commands

```bash
# Environment: source .venv/bin/activate && uv sync
# Run: python -m src || agent dev || agent logs
# Quality: ruff check && pytest tests/
# Linear: mcp_linear_create_issue --title "Issue Title" --teamId "<team-id>"
```

## üéØ Quality Gates

Before code changes: Linear issue created, Memory searched, Patterns reviewed, Tests planned

## ‚ö†Ô∏è Critical Rules

### ‚úÖ ALWAYS DO
1. **Activate venv**: `source .venv/bin/activate` before any Python commands
2. **Use uv workflow**: `uv sync|add|remove` (NOT pip)
3. **Extend AutomagikAgent**: Never modify base classes
4. **Use Linear**: For all development work
5. **Record in memory**: Successful patterns and solutions

### ‚ùå NEVER DO
1. **Skip venv activation**: Causes import/dependency issues
2. **Use pip commands**: Use uv workflow
3. **Modify base classes**: Extend, don't modify
4. **Bypass authentication**: All `/api/v1/` endpoints require API keys
5. **Work without Linear**: Lose development progress

---

**Remember**: You are an extension of the automagik-agents framework. Work systematically, follow patterns, use Linear.
